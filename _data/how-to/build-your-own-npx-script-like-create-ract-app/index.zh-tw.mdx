---
lang: zh-tw
title: How to - å¦‚ä½•æ‰“é€ åƒæ˜¯ create-react-app çš„ npx script ï¼ˆä»¥ create-threejs-starter-pack ç‚ºä¾‹ï¼‰
baseSlug: "/build-your-own-npx-script-like-create-ract-app"
belongToSeries: false
seriesKey: 
seriesSlug:
tags: ["how-to", "npx", "boilerplate"]
components: []
hasTranslation: false
publishedAt: "2021-09-19T12:00:00"
lastModified: "2021-09-19T12:00:00"
description: Npx Script å°‡å¤§å¹…æå‡æˆ‘å€‘é–‹ç™¼ã€éƒ¨ç½²çš„é€Ÿåº¦ï¼Œé€é create-threejs-starter-pack ç‚ºä¾‹ï¼Œé€™ç¯‡æ–‡ç« è§£é‡‹äº†ä½ å¦‚ä½•å‰µå»ºè‡ªå·²çš„ npx script
---

ä¸Šä¸€ç¯‡æ–‡ç«  [How to - æ‰“é€ è‡ªå·±çš„ Three.js boilerplate](https://www.summerbud.org/zh-tw/how-to/build-your-own-threejs-boilerplate) è¬›è¿°äº†å¦‚ä½•å¾é›¶é–‹å§‹ç”¨ Webpack æ‰“é€ è‡ªå·±çš„ Three.js boilerplateï¼Œé›–ç„¶æˆ‘å€‘å¯ä»¥ç”¨ git clone æŠŠè³‡æ–™æ”¾ä¸‹ä¾†ï¼Œä½†é‚£æ¨£æˆ‘å€‘é‚„æ˜¯éœ€è¦é‡æ–°å®‰è£å¥—ä»¶ï¼Œé‡æ–°è¨­å®š package.json å’Œ gitï¼Œç¸±ä½¿åªéœ€è¦ååˆ†é˜å·¦å³ï¼Œå»ä»ä¸å¤ è‡ªå‹•åŒ–ã€‚

é€™é‚Šæˆ‘æŒå®ˆçš„å¿ƒæ™ºæ¨¡å‹æ˜¯ï¼Œä¸€ä½†æœ‰é‡è¤‡å‹•ä½œçš„è¡Œç‚ºï¼Œéƒ½è¦ç›¡å¯èƒ½è‡ªå‹•åŒ–ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘çµ±ä¸€ä½¿ç”¨ç›¸åŒçš„ git commit æ¨¡æ¿çš„åŸå› ï¼ˆ[Lesson-learned - å‰µé€ ä½ è‡ªå·±çš„ git commit ç³»çµ±](https://www.summerbud.org/zh-tw/lesson-learned/construct-your-own-git-commit-system)ï¼‰ã€‚ä»¥ä¸‹è·Ÿå¤§å®¶åˆ†äº«å¦‚ä½•ä½¿ç”¨ npm ä¸­çš„ npx command line ä¾†è‡ªå‹•åŒ–é€™ä¸€ç³»åˆ—å‹•ä½œï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å¯ä»¥æŠŠåŸæœ¬éœ€è¦ååˆ†é˜åšå®Œçš„äº‹æƒ…ï¼Œç¸®æ¸›æˆä¸€åˆ†é˜å…§å°±å¯ä»¥è‡ªå‹•å®Œæˆã€‚

> Npx === Speed

## ä½¿ç”¨ bin ä¾†åŸ·è¡Œç¨‹å¼ç¢¼
npx çš„å®˜æ–¹æ–‡ä»¶ä¸­è§£é‡‹ npx æœƒä½¿ç”¨ local `node_modules/.bin` æˆ–æ˜¯æ ¸å¿ƒçš„æš«å­˜ä¸­çš„ bin åŸ·è¡Œæª”ã€‚

> Executes `<command>` either from a local `node_modules/.bin`, or from a central cache, installing any packages needed in order for `<command>` to run.[^1]

æˆ‘å€‘è¦é‹ç”¨é€™å€‹ç‰¹è³ªï¼Œåœ¨æˆ‘å€‘çš„ repo åŠ å…¥ bin åŸ·è¡Œæª”ï¼Œä¾†è‡ªå‹•åŒ–ä»¥ä¸‹çš„è¡Œç‚ºã€‚

1. å»ºç«‹è³‡æ–™å¤¾
2. å¾ä½ çš„ github-repo æŠŠå…¬ç‰ˆ clone ä¸‹ä¾†
3. npm install
4. ç¢ºå®šè³‡æ–™çµæ§‹æ­£ç¢º
5. æ¸…ç†å¤šé¤˜è³‡æ–™

é¦–å…ˆåœ¨ä½ çš„ repo ä¸­åŠ å…¥ `<root_folder>/bin/<whatever_you_want>.js` çš„æª”æ¡ˆï¼Œéš¨å¾Œåœ¨ package.json ä¹‹ä¸­åŠ ä¸Šé€™å¹¾è¡Œè³‡è¨Šã€‚

```json
// package.json

"bin": {
	"create-threejs-starter-pack": "bin/<whatever_you_want>.js"
}
```

## RunCommand

åœ¨æˆ‘å€‘é è¨ˆåŸ·è¡Œçš„æŒ‡ä»¤ä¸­ï¼Œæœ‰å¤šå€‹é …ç›®éœ€è¦ä½¿ç”¨ async await ä¾†è™•ç†ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦é å…ˆå¯«å¹¾å€‹ helper ä¾†å¹«åŠ©æˆ‘å€‘è™•ç†é€™ä»¶äº‹ã€‚ä»¥ä¸‹æ˜¯æˆ‘å€‘æœ€ä¸»è¦çš„ helperã€‚[^2]

```js
const exec = util.promisify(require("child_process").exec);
```

ç‚ºäº†åŸ·è¡ŒæŒ‡ä»¤ï¼Œnode.js æä¾› child_process.exec() é€™é¡æ–¹ç¨‹å¼ï¼Œä½†å®ƒéœ€è¦ä½¿ç”¨ Error-first style callback function[^3]ï¼Œæœƒå¸¶ä¾†å¤§å®¶éå¸¸æŠ—æ‹’çš„ Callback hell å•é¡Œï¼Œä¾‹å¦‚ï¼š[^4]

```js
exec('my.bat', (err, stdout, stderr) => {
  if (err) {
    console.error(err);
    return;
  }
  console.log(stdout);
});
```

å¹¸å¥½å¯ä»¥ä½¿ç”¨ Promisify æŠŠé€™é¡éœ€è¦ Callback çš„ function è½‰åŒ–ç‚ºæ¯”è¼ƒå¥½è™•ç†çš„ Promise å½¢å¼ã€‚ï¼ˆä½†è¦æ³¨æ„ Promisify åªèƒ½è½‰æ›ä½¿ç”¨ä»¥ä¸Šé€™é¡ Callback çš„æ–¹ç¨‹å¼ï¼‰ç„¶å¾ŒæŠŠå®ƒåŒ…åœ¨ async await æ–¹ç¨‹å¼ä¹‹ä¸­ï¼Œé€™æ¨£ä½¿ç”¨ä¸Šå°±éå¸¸æ–¹ä¾¿äº†ã€‚

```js
const runCmd = async (command) => {
  try {
    const { stdout, stderr } = await exec(command);
    console.log(stdout);
    console.log(stderr);
  } catch(err) {
    return Promise.reject(err)
  }
};
```

## ç¢ºèªä½¿ç”¨è€…æœ‰æ²’æœ‰è¼¸å…¥è³‡æ–™å¤¾åç¨±

ç”±æ–¼æˆ‘å€‘å¸Œæœ›ä½¿ç”¨è€…åœ¨ä½¿ç”¨ npx æŒ‡ä»¤æ™‚æœƒé å…ˆè¼¸å…¥å‰µå»ºè³‡æ–™å¤¾çš„åç¨±ï¼Œå¤§æ¦‚æœƒé•·é€™æ¨£ `npx create-threejs-starter-pack <folder_name>` å› æ­¤éœ€è¦ç¢ºèªä½¿ç”¨è€…æ˜¯å¦æœ‰æ­£ç¢ºè¼¸å…¥é€™å€‹åƒæ•¸ã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ `process.argv` ä¾†ç¢ºèªé€™ä»¶äº‹ï¼Œä»–ç¸½å…±æœƒçµ¦æˆ‘å€‘ä¸‰å€‹è®Šæ•¸[^5]

1.  process.execPath eg. `/usr/local/bin/node'`
2.  è¢«åŸ·è¡Œçš„ js æª”æ¡ˆçš„è·¯å¾‘
3.  é¡å¤–è¼¸å…¥çš„åƒæ•¸åˆ—è¡¨ï¼ˆä¹Ÿå°±æ˜¯æˆ‘å€‘æƒ³è¦ä½¿ç”¨è€…è¼¸å…¥çš„ folder_nameï¼‰

æœ‰äº†ä»¥ä¸Šè³‡è¨Šä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¯«å‡ºç°¡å–®çš„åˆ¤æ–·å¼ä¾†åˆ¤æ–·ä½¿ç”¨è€…æœ‰æ²’æœ‰æ­£ç¢ºè¼¸å…¥è³‡æ–™å¤¾åç¨±ã€‚ä¸¦ä¸”æ–¼å…¶å¾Œå‰µå»ºè©²è³‡æ–™å¤¾ï¼Œå¦‚æœè³‡æ–™å¤¾åç¨±é‡è¤‡ï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦æé†’ä½¿ç”¨è€…è¦ä½¿ç”¨å…¶ä»–åç¨±ã€‚

```js
if (process.argv.length < 3) {
  console.log(c.red.bold("Please name for your threejs project"));
  process.exit(1);
}

const appName = process.argv[2];
const starterPackPath = path.join(process.cwd(), appName);

try {
  fs.mkdirSync(starterPackPath); // å‰µå»ºè³‡æ–™å¤¾
} catch (err) {
  if (err.code === "EEXIST") { // å­˜æœ‰ç›¸åŒåç¨±çš„è³‡æ–™å¤¾
    console.log(c.red.bold(`App name ${appName} already exist`));
  } else {
    console.log(err);
  }
  process.exit(1);
}
```

## åŸ·è¡Œæˆ‘å€‘æƒ³è¦è‡ªå‹•åŒ–å®Œæˆçš„æŒ‡ä»¤

åœ¨é€™å€‹å°ˆæ¡ˆä¸­æˆ‘å¸Œæœ›å¯ä»¥å®Œæˆé€™å¹¾ä»¶äº‹ï¼š

1. å¾ä½ çš„ github-repo æŠŠå…¬ç‰ˆ clone ä¸‹ä¾†
2. npm install
3. ç§»é™¤ git ï¼ˆè®“é€™å€‹å°ˆæ¡ˆé‡æ–°é–‹å§‹ï¼‰
4. ç¢ºå®šè³‡æ–™çµæ§‹æ­£ç¢º
5. æ¸…ç†å¤šé¤˜è³‡æ–™

å¦‚æœé€™å€‹ npx ä¸åªæ˜¯çµ¦ä½ è‡ªå·±ç”¨çš„è©±ï¼Œæˆ‘å€‘è¦ç•™ä¸€å€‹ä¹¾æ·¨çš„ package.json çµ¦ä½¿ç”¨è€…ã€‚

```js
const buildPackageJson = () => {
  const newPackage = {
    name: appName,
    version: "0.1.0",
    scripts: {
      dev: "webpack serve --config ./webpack/webpack.dev.js",
      build: "webpack --config ./webpack/webpack.prod.js",
    },
    dependencies: {
      ...
    },
    devDependencies: {
      ...
    },
  };
  
  // å°‡è³‡æ–™å¯«å…¥æ–°çš„ package.json
  
  fs.writeFileSync( 
    `${process.cwd()}/package.json`,
    JSON.stringify(newPackage, null, 2),
    "utf8"
  );
};
```

æ¥ä¸‹ä¾†å°±æ˜¯ä¾åºä½¿ç”¨ `runCmd` ä¾†è‡ªå‹•åŒ–æˆ‘å€‘çš„æµç¨‹ã€‚

```js
const setup = async () => {
  try {
  
  	// Clone github
    await runCmd(`git clone --depth 1 ${repo} ${appName}`);

  	// é€²å…¥è©²è³‡æ–™å¤¾
    process.chdir(starterPackPath);
  
  	// å®‰è£å¥—ä»¶
    await runCmd("npm install");

    // Remove git link
    await runCmd('npx rimraf ./.git');
	
    // ç§»é™¤èˆŠçš„ package.json
    fs.unlinkSync(path.join(starterPackPath, "package.json"));

    // ç§»é™¤ bin è³‡æ–™å¤¾
    fs.rm(path.join(starterPackPath, 'bin'), { recursive: true })
    
    // å‰µå»ºæ–°çš„ package.json
    buildPackageJson()
    
    // ç§»é™¤ä¸€äº›æŒ‡ç¤ºæ€§çš„å¥—ä»¶ï¼Œä¾‹å¦‚é€™å€‹ command-line color tool
    await runCmd("npm uninstall ansi-colors");
    
    console.log("ğŸ‰  You had successfully set up the starter pack")
    console.log("Check README.md for more informations")

  } catch(err){
    console.log(c.red.bold(err))
  }
};
```

## Npm publish

åšåˆ°é€™è£¡åªå·®æœ€å¾Œä¸€æ­¥å°±å¯ä»¥æ“æœ‰è‡ªå·±çš„ npx script å•¦ã€‚é¦–å…ˆåˆ° npm ç”³è«‹å¸³è™Ÿï¼Œç”³è«‹å®Œä¹‹å¾Œä¹Ÿä¸è¦å¿˜äº†é»æ“Šå¯„é€åˆ°ä½ çš„é›»å­ä¿¡ç®±å…§çš„ç¢ºèªä¿¡ï¼Œä¸ç„¶åˆ°æ™‚å€™ publish æ™‚æœƒæ”¶åˆ°è®“äººé©šæ…Œçš„ Forbidden 403 å“¦ã€‚

åœ¨ Publish ä¹‹å‰æˆ‘å€‘éœ€è¦å°‡ package.json åŠ ä¸Šå¹¾å€‹è³‡è¨Šï¼ˆè«‹åƒè€ƒ[^6]ï¼‰

- mainï¼šä½ çš„ç¨‹å¼ä¸»è¦çš„ js é€²å…¥é»
- license
- repositoryï¼šé€™å€‹ npm package ç¨‹å¼ç¢¼çš„å„²å­˜é»
- bugsï¼šå›å ±éŒ¯èª¤ä¹‹è™•
- homepageï¼šä¸»è¦ä»‹ç´¹é é¢ 
- keywordsï¼šè®“ä»–äººæœå°‹åˆ°çš„é—œéµå­—

ä¸€åˆ‡éƒ½è¨­å®šå¥½ä¹‹å¾Œï¼Œ`npm login` ç™»å…¥ä½ çš„å¸³è™Ÿã€‚ä¸¦ä¸”åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸‹ `npm publish` ç™¼å¸ƒä½ çš„å¥—ä»¶ï¼

VoilÃ 

æ¥ä¸‹ä¾†å°±å¯ä»¥ä½¿ç”¨ `npx <your_package_name> <folder_name>` ä¾†å•Ÿå‹•è‡ªå·±çš„ APP å•¦ï¼



[^1]: [npm/npx: npm package executor](https://github.com/npm/npx#description)
[^2]: [Generate your web-app boilerplate like create-react-app does. - DEV Community](https://dev.to/leopold/generate-your-web-app-boilerplate-like-create-react-app-does-301p)
[^3]: [Realdennis - Promisify èˆ‡ Callbackify â€” ä½ æˆ–è¨±ç”¨ä¸åˆ°ï¼Œä½†äº†è§£ä¸€ä¸‹ä¹Ÿç„¡å¦¨](https://realdennis.medium.com/promisify-%E8%88%87-callbackify-%E4%BD%A0%E6%88%96%E8%A8%B1%E7%94%A8%E4%B8%8D%E5%88%B0-%E4%BD%86%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E4%B9%9F%E7%84%A1%E5%A6%A8-193d7091c091)
[^4]: node.js å®˜æ–¹æ–‡ä»¶ä¾‹å­ [Child process | Node.js v16.9.1 Documentation (nodejs.org)](https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback)
[^5]: [Process | Node.js v16.9.1 Documentation (nodejs.org)](https://nodejs.org/docs/latest/api/process.html#process_process_argv)
[^6]: [EiffelFly/create-threejs-starter-pack - package.json](https://github.com/EiffelFly/create-threejs-starter-pack/blob/main/package.json)